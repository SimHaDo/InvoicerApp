# Простая iCloud синхронизация

## Текущая реализация

Приложение использует **упрощенную синхронизацию через iCloud Key-Value Storage (KVS)** для базовой синхронизации настроек и небольших данных.

## Что синхронизируется:

✅ **Настройки приложения** - через CloudSync.shared  
✅ **Статус подписки** - через CloudSync.shared  
✅ **Выбранный шаблон** - через CloudSync.shared  
✅ **Статус онбординга** - через CloudSync.shared  

## Что НЕ синхронизируется:

❌ **Данные компании** - только локально  
❌ **Клиенты** - только локально  
❌ **Продукты** - только локально  
❌ **Инвойсы** - только локально  
❌ **PDF файлы** - только локально  

## Настройка для работы:

### 1. Xcode Project Settings

1. **Откройте проект в Xcode**
2. **Выберите target приложения**
3. **Перейдите в "Signing & Capabilities"**
4. **Добавьте "iCloud" capability**
5. **Включите "CloudKit"**
6. **Убедитесь, что выбран правильный контейнер**: `iCloud.SimHaDo.InvoicerApp`

### 2. Entitlements Configuration

Убедитесь, что в `InvoicerApp.entitlements` есть:

```xml
<key>com.apple.developer.icloud-container-identifiers</key>
<array>
    <string>iCloud.SimHaDo.InvoicerApp</string>
</array>
<key>com.apple.developer.icloud-services</key>
<array>
    <string>CloudKit</string>
</array>
```

### 3. Тестирование

#### Требования:
- ✅ **Реальное устройство** (не симулятор)
- ✅ **Включенный iCloud** на устройстве
- ✅ **Вход в iCloud** с Apple ID
- ✅ **Интернет-соединение**

#### Шаги тестирования:
1. **Запустите приложение**
2. **Перейдите в Settings > iCloud Sync**
3. **Проверьте статус подключения** (должен быть "Connected")
4. **Измените настройки** (шаблон, подписка)
5. **Проверьте синхронизацию** на другом устройстве

## Ограничения текущей реализации:

### 1. Размер данных
- iCloud KVS имеет лимит ~1MB на приложение
- Подходит только для небольших настроек
- НЕ подходит для больших данных (клиенты, инвойсы, PDF)

### 2. Типы данных
- Только простые типы: Bool, String, Number
- НЕ поддерживает сложные объекты
- НЕ поддерживает файлы

### 3. Синхронизация
- Только настройки синхронизируются
- Основные данные остаются локальными
- НЕ соответствует полным требованиям acceptance criteria

## Для полной синхронизации потребуется:

### Вариант 1: NSPersistentCloudKitContainer (Рекомендуется)
- Автоматическая синхронизация всех данных
- Поддержка файлов и вложений
- Автоматическое разрешение конфликтов
- Полное соответствие acceptance criteria

### Вариант 2: Ручная реализация CloudKit
- Полный контроль над синхронизацией
- Требует настройки CloudKit Dashboard
- Больше кода для поддержки
- Полное соответствие acceptance criteria

## Текущий статус:

✅ **Проект собирается** - все ошибки компиляции исправлены  
✅ **Базовая синхронизация работает** - настройки синхронизируются  
❌ **Полная синхронизация НЕ реализована** - основные данные не синхронизируются  

## Следующие шаги:

1. **Протестировать текущую функциональность**
2. **Решить, нужна ли полная синхронизация**
3. **Если нужна - реализовать NSPersistentCloudKitContainer**
4. **Если не нужна - оставить как есть**

Текущая реализация обеспечивает базовую синхронизацию настроек, но НЕ соответствует полным требованиям acceptance criteria для синхронизации всех данных между устройствами.
