# Диагностика CloudKit синхронизации

## Проблема: Синхронизация не работает на реальном устройстве

### Шаги диагностики:

#### 1. Проверьте логи в Xcode Console
Откройте Xcode → Window → Devices and Simulators → выберите ваше устройство → View Device Logs

Ищите следующие сообщения:
```
CoreDataAdapter: Checking CloudKit status...
CoreDataStack: CloudKit account status: available
CoreDataAdapter: CloudKit status result: true
CoreDataAdapter: CloudKit is available!
AppState: Setting up Core Data sync...
AppState: Migrating data from UserDefaults to Core Data...
AppState: Loading data from Core Data...
```

#### 2. Проверьте статус в приложении
1. Откройте приложение
2. Перейдите в Settings → iCloud Sync
3. Проверьте статус:
   - ✅ "iCloud Connected" - CloudKit работает
   - ❌ "iCloud Not Connected" - есть проблемы

#### 3. Проверьте настройки устройства
1. **Настройки → [Ваше имя] → iCloud**
   - Убедитесь, что iCloud включен
   - Проверьте, что CloudKit включен
   
2. **Настройки → [Ваше имя] → iCloud → iCloud Drive**
   - Убедитесь, что iCloud Drive включен

3. **Настройки → [Ваше имя] → iCloud → Приложения, использующие iCloud**
   - Найдите "InvoicerApp" и убедитесь, что он включен

#### 4. Проверьте интернет-соединение
- Убедитесь, что устройство подключено к Wi-Fi или сотовой сети
- Проверьте, что интернет работает (откройте Safari)

#### 5. Проверьте Apple ID
- Убедитесь, что вы вошли в iCloud с правильным Apple ID
- Попробуйте выйти и войти заново в iCloud

### Возможные проблемы и решения:

#### Проблема: "CloudKit недоступен. Проверьте подключение к iCloud."
**Решение:**
1. Проверьте интернет-соединение
2. Убедитесь, что iCloud включен в настройках
3. Перезапустите приложение
4. Подождите несколько минут (CloudKit может быть медленным)

#### Проблема: "No company found in Core Data"
**Решение:**
1. Создайте данные в приложении (добавьте информацию о компании)
2. Проверьте, что данные сохраняются
3. Попробуйте ручную синхронизацию

#### Проблема: Данные не синхронизируются между устройствами
**Решение:**
1. Убедитесь, что оба устройства используют один Apple ID
2. Подождите 5-10 минут (синхронизация может быть медленной)
3. Попробуйте ручную синхронизацию на обоих устройствах
4. Перезапустите приложение на обоих устройствах

### Тестирование синхронизации:

#### На устройстве A:
1. Создайте тестовые данные:
   - Добавьте информацию о компании
   - Создайте клиента
   - Добавьте продукт
   - Создайте инвойс

2. Проверьте статус синхронизации в Settings → iCloud Sync

#### На устройстве B:
1. Установите приложение
2. Войдите в тот же Apple ID
3. Подождите 5-10 минут
4. Проверьте появление данных

### Логи для отладки:

Добавлены подробные логи в код:
- `CoreDataAdapter` - статус CloudKit
- `CoreDataStack` - статус аккаунта CloudKit
- `AppState` - загрузка данных из Core Data

### Время синхронизации:
- **Малые данные** (настройки): 1-5 секунд
- **Средние данные** (клиенты, продукты): 5-15 секунд  
- **Большие данные** (PDF файлы): 15-60 секунд
- **Медленное соединение**: может занять несколько минут

### Если ничего не помогает:

1. **Удалите приложение** с устройства
2. **Перезагрузите устройство**
3. **Переустановите приложение**
4. **Проверьте, что iCloud работает** с другими приложениями
5. **Обратитесь в поддержку Apple** если проблема с iCloud

### Контакты для поддержки:
- Apple Developer Support: https://developer.apple.com/support/
- CloudKit Documentation: https://developer.apple.com/documentation/cloudkit
